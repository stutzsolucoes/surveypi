// Generated by CoffeeScript 1.7.1
(function() {
  var expect, superagent;

  superagent = require('superagent');

  expect = require('expect.js');

  describe('unidesc Smartphone survey', function() {
    var id, regularEnd, survey_id;
    this.timeout(1000);
    id = null;
    regularEnd = function(e, res) {
      var obj, _i, _len, _ref, _results;
      expect(e).to.eql(null);
      expect(res.body.length).to.be.above(0);
      expect(res.body[0]._id.length).to.eql(24);
      _ref = res.body;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        _results.push(obj._id);
      }
      return _results;
    };
    survey_id = null;
    it('Criar o questionario', function(done) {
      return superagent.post('http://localhost:3000/survey').send({
        title: 'Perfil de uso de smartphones dos alunos do Unidesc'
      }).end(function(e, res) {
        survey_id = regularEnd(e, res)[0];
        console.log(survey_id);
        return done();
      });
    });
    return it('criar questões da pesquisa de uso smartphones', function(done) {
      return superagent.post('http://localhost:3000/survey_question').send([
        {
          type: 1,
          title: 'Você possui Smartphone? Qual modelo?',
          options: ['Não possuo', 'Android', 'iPhone', 'Windows Phone'],
          lastOptionLabel: 'Outro',
          lastOptionCustomAnswearEnabled: false
        }, {
          type: 2,
          title: 'Quais aplicativos você mais usa?',
          options: ['E-mail', 'Facebook', 'Twitter', 'WhatsApp', 'Instagram', 'Youtube', 'Internet banking', 'SMS', 'Calendário / Agenda', 'Notas / anotações', 'Jogos', 'Podcast', 'Mapas e GPS (Waze, Google Maps, iOS Maps, etc)', 'Música (Deezer, Rdio, iTunes, Grooveshark, etc)'],
          lastOptionLabel: 'Outro',
          lastOptionCustomAnswearEnabled: true
        }
      ]).end(function(e, res) {
        var questions_ids;
        questions_ids = regularEnd(e, res);
        return superagent.get('http://localhost:3000/survey/' + survey_id).end(function(e, res) {
          var idx, question_id, survey, _i, _len;
          survey = res.body;
          survey.questions = [];
          for (idx = _i = 0, _len = questions_ids.length; _i < _len; idx = ++_i) {
            question_id = questions_ids[idx];
            survey.questions.push({
              "question_id": question_id,
              "order": idx
            });
          }
          delete survey._id;
          survey.client_custom_attributes = [];
          survey.client_custom_attributes.push("matricula_id");
          survey.client_custom_attributes.push("numero_matricula");
          survey.client_custom_attributes.push("turma_id");
          return superagent.put('http://localhost:3000/survey/' + survey_id).send(survey).end(function(e, res) {
            expect(e).to.eql(null);
            expect(typeof res.body).to.eql('object');
            expect(res.body.msg).to.eql('success');
            return done();
          });
        });
      });
    });
  });

}).call(this);
