// Generated by CoffeeScript 1.7.1
(function() {
  var expect, superagent;

  superagent = require('superagent');

  expect = require('expect.js');

  describe('stutz survey api', function() {
    var id;
    this.timeout(1000);
    id = null;
    it('basic endpoint 503', function(done) {
      return superagent.get('http://localhost:3000/').end(function(e, res) {
        expect(e).to.eql(null);
        expect(res.status).to.eql(503);
        return done();
      });
    });
    it('post object', function(done) {
      return superagent.post('http://localhost:3000/surveys').send({
        name: 'Stutz',
        email: 'stutz@stutzsolucoes.com.br'
      }).end(function(e, res) {
        expect(e).to.eql(null);
        expect(res.body.length).to.eql(1);
        expect(res.body[0]._id.length).to.eql(24);
        id = res.body[0]._id;
        return done();
      });
    });
    it('retrieves an object', function(done) {
      return superagent.get('http://localhost:3000/surveys/' + id).end(function(e, res) {
        expect(e).to.eql(null);
        expect(typeof res.body).to.eql('object');
        expect(res.body._id.length).to.eql(24);
        expect(res.body._id).to.eql(id);
        return done();
      });
    });
    it('retrieves a collection', function(done) {
      superagent.get('http://localhost:3000/surveys').end(function(e, res) {
        expect(e).to.eql(null);
        expect(res.body.length).to.be.above(0);
        return expect(res.body.map(function(item) {
          return item._id;
        })).to.contain(id);
      });
      return done();
    });
    it('updates an object', function(done) {
      return superagent.put('http://localhost:3000/surveys/' + id).send({
        name: 'New Stutz',
        email: 'new@stutzsolucoes.com.br'
      }).end(function(e, res) {
        expect(e).to.eql(null);
        expect(typeof res.body).to.eql('object');
        expect(res.body.msg).to.eql('success');
        return done();
      });
    });
    it('checks an updated object', function(done) {
      return superagent.get('http://localhost:3000/surveys/' + id).end(function(e, res) {
        expect(e).to.eql(null);
        expect(typeof res.body).to.eql('object');
        expect(res.body._id.length).to.eql(24);
        expect(res.body._id).to.eql(id);
        expect(res.body.name).to.eql('New Stutz');
        return done();
      });
    });
    return it('removes an object', function(done) {
      return superagent.del('http://localhost:3000/surveys/' + id).end(function(e, res) {
        expect(e).to.eql(null);
        expect(typeof res.body).to.eql('object');
        expect(res.body.msg).to.eql('success');
        return done();
      });
    });
  });

}).call(this);
